apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: backend-api-ingress-prod
  namespace: backend-prod
  annotations:
    # AWS Load Balancer Controller 사용
    kubernetes.io/ingress.class: alb
    alb.ingress.kubernetes.io/scheme: internet-facing
    alb.ingress.kubernetes.io/target-type: ip
    #  TODO: cert-manager ClusterIssuer 이름 확인 (letsencrypt-prod 권장)
    cert-manager.io/cluster-issuer: letsencrypt-staging  # Staging 인증서
    # CORS 설정
    alb.ingress.kubernetes.io/actions.ssl-redirect: |
      {
        "Type": "redirect",
        "RedirectConfig": {
          "Protocol": "HTTPS",
          "Port": "443",
          "StatusCode": "HTTP_301"
        }
      }
spec:
  tls:
  - hosts:
    # TODO: YOUR_DOMAIN을 실제 도메인으로 변경 (예: goteego.store)
    - api.goteego.store
    secretName: backend-api-prod-tls
  rules:
  #  TODO: YOUR_DOMAIN을 실제 도메인으로 변경
  - host: api.goteego.store
    http:
      paths:
        - path: /
          pathType: Prefix
          backend:
            service:
              name: backend-api-service # base의 서비스 이름
              port:
                number: 80
